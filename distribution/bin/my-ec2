#!/usr/bin/env bash

export AWS_DEFAULT_REGION=$(curl -s --connect-timeout 3 -s http://169.254.169.254/latest/dynamic/instance-identity/document/ | perl -ne '/region"\s+:\s+"([^"]+)/ && print $1')

function region {
    echo ${AWS_DEFAULT_REGION}
}
function instance-id {
    curl -s --connect-timeout 3 http://169.254.169.254/latest/meta-data/instance-id
}
function instance-tag {
    aws ec2 describe-tags --filters "Name=resource-id,Values=$(instance-id)" --query "Tags[?Key==\`${1}\`].Value[]" --output text
}
function public-ipv4 {
    curl -s --connect-timeout 3 http://169.254.169.254/latest/meta-data/public-ipv4
}


COMMAND=$1
shift

${COMMAND} $*